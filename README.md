# TOEIC 自動問題配信・採点・Geminiフィードバックシステム（Google Apps Script）

## プロジェクト概要

このGoogle Apps Scriptプロジェクトは、TOEIC Part 5・6・7形式の問題をAI（Gemini）で自動生成し、Googleフォームと連携して配信・採点・個別フィードバックを自動化します。

- 問題文・設問・選択肢をAIで自動生成し、メールで配信
- Googleフォームで受験者が回答
- 回答内容を自動採点し、Geminiによる詳細な解説・アドバイスを自動生成
- 採点結果とフィードバックをメールで自動送信

---

## 主な機能

- **Part 5, 6, 7（前半・後半）すべてに対応**
- メニューから任意パートの問題を即時配信可能
- 毎日6〜7時にPart 5・6・7前半のいずれかをランダム配信
- 毎日17〜18時にPart 7後半を自動配信
- 回答はGoogleフォームで受け付け、自動採点・AIフィードバックをメール返送
- 問題・正解・設問・配信履歴をスプレッドシートに自動記録

---

## セットアップ手順

### 1. Google スプレッドシートの準備

1. 新規スプレッドシートを作成し、以下のシートを追加してください（シート名は正確に）:

   - `setting`  
     - B1セル: Gemini APIキー  
     - B2セル: GoogleフォームID（フォーム作成後に取得）

   - `mail`  
     - B列: 配信先メールアドレス（2行目以降に1行1アドレス）

   - `answers`  
     - A列: 日時  
     - B～F列: 正解（A/B/C/D、最大5問分）  
     - G列: パート名（Part 5/6/7 前半/7 後半）

   - `forms`  
     - A列: 日時  
     - B列: 問題文（本文）  
     - C列: 設問＋選択肢

   - `userAnswers`  
     - 回答内容の記録用（運用に応じて）

---

### 2. Googleフォームの準備

1. 新規Googleフォームを作成
2. 設問例（3問の場合）:
   - Q1: 設問1（ラジオボタン A/B/C/D）
   - Q2: 設問2（ラジオボタン A/B/C/D）
   - Q3: 設問3（ラジオボタン A/B/C/D）
3. フォームのIDを取得し、`setting`シートのB2セルに貼り付け

---

### 3. Apps Scriptのセットアップ

1. スプレッドシートの「拡張機能」→「Apps Script」を開く
2. このリポジトリの`code.js`と`partFunctions.js`、`appsscript.json`をプロジェクトに追加
3. 必要に応じて`test.js`はローカルテスト用として利用

---

### 4. メニューの追加

- スプレッドシートを開くと自動で「study」メニューが追加されます。
- 「Part 5」「Part 6」「Part 7 前半」「Part 7 後半」から任意のパートを即時配信可能です。

---

### 5. トリガーの設定

- `onFormSubmit`関数を「フォーム送信時」トリガーに設定  
  （Apps Scriptエディタの「トリガー」→「トリガーを追加」→「onFormSubmit」→「フォーム送信時」）
- 時間主導型トリガーで
  - 毎日6〜7時に`runRandomPart5or6or7Single`
  - 毎日17〜18時に`runPart7Multi`
  を自動実行するよう設定

---

### 6. Gemini APIキーの取得

- Google AI Studio等でGemini APIキーを取得し、`setting`シートのB1セルに貼り付け

---

## 運用フロー

1. メニューまたは自動配信で問題が生成され、メールで配信
2. 受験者はメール内リンクからGoogleフォームで回答
3. 回答送信時に自動で採点・Geminiによるフィードバックが生成され、メールで返送される
4. 問題・正解・設問・パート名は`answers`シートに記録され、フィードバックメールの件名にも正しいパート名が反映されます

---

## 注意事項

- メール配信先は`mail`シートのB列に記載したアドレスになります
- フォームにメールアドレス欄を設けていない場合、個別返信はできません（全員同じアドレスに送信）
- 複数人・複数回運用時は、問題・回答の紐付けに注意してください
- Gemini APIの利用にはAPIキーと利用制限があります

---

## ライセンス

MIT License